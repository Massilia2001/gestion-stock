{% extends "base.html" %}
{% block title %}Visualisation des ventes{% endblock %}
{% block content %}
<h1>Historique des ventes</h1>

<div style="width: 90%; max-width:650px; margin: 0 auto 2.5rem auto; box-shadow:0 2px 16px #0001; border-radius:16px; background: #f7f8fa; padding:2rem;">
    <h2 style="color:#2d6cdf; margin-bottom:1em; font-size:1.2em;">Courbe des ventes</h2>
    <canvas id="salesChart"></canvas>
</div>

<table style="
    margin: 0 auto 2rem auto;
    border-collapse: collapse;
    width: 90%;
    background: #fff;
    box-shadow: 0 2px 12px #0001;
    border-radius: 14px;
    overflow: hidden;
    ">
    <thead style="background: #eaf0fc;">
        <tr>
            <th style="padding: 1em 1.5em; color: #2d6cdf;">Date</th>
            <th style="padding: 1em 1.5em; color: #2d6cdf;">Ventes</th>
        </tr>
    </thead>
    <tbody>
        {% for s in sales %}
        <tr style="background: {{ loop.index0 % 2 == 0 and '#f7f8fa' or '#fff' }};">
            <td style="padding: 0.7em 1.5em;">{{ s.ds }}</td>
            <td style="padding: 0.7em 1.5em;">{{ s.y }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const sales = {{ sales | tojson }};
    const labels = sales.map(s => s.ds);
    const data = sales.map(s => s.y);

    new Chart(document.getElementById('salesChart').getContext('2d'), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Ventes',
                data: data,
                borderColor: '#2d6cdf',
                backgroundColor: 'rgba(45,108,223,0.10)',
                pointRadius: 2,
                pointHoverRadius: 5,
                tension: 0.25,
                fill: true
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: false }
            },
            scales: {
                x: { title: { display: true, text: 'Date', color: '#888' }},
                y: { title: { display: true, text: 'Ventes', color: '#888' }}
            }
        }
    });
</script>
{% endblock %}
